<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯†ç ä¿æŠ¤è¡¨ç™½å¢™</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #f5fafe; font-family: 'Arial', sans-serif; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        h1 { text-align: center; color: #2d3748; margin: 30px 0; }
        .form-box { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 15px rgba(0,0,0,0.05); margin-bottom: 40px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: #4a5568; font-weight: 500; }
        input, textarea { width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 16px; resize: none; }
        input:focus, textarea:focus { outline: none; border-color: #4299e1; box-shadow: 0 0 0 3px rgba(66,153,225,0.1); }
        button { background: #4299e1; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 16px; cursor: pointer; transition: background 0.3s; }
        button:hover { background: #3182ce; }
        .wall { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 1px 10px rgba(0,0,0,0.05); position: relative; }
        .card h3 { color: #2d3748; margin-bottom: 10px; font-size: 18px; }
        .card p { color: #4a5568; line-height: 1.6; margin-bottom: 15px; }
        .card .time { color: #718096; font-size: 14px; position: absolute; bottom: 15px; right: 20px; }
        .delete-btn { position: absolute; top: 15px; right: 15px; background: #fef2f2; color: #dc2626; border: none; width: 28px; height: 28px; border-radius: 50%; font-size: 14px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .password-tip { font-size: 14px; color: #718096; margin-top: 5px; }
    </style>
    <!-- å¼•å…¥CryptoJSç”¨äºAESåŠ å¯† -->
    <script src="https://cdn.bootcdn.net/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>ğŸ’Œ ç™½ç²Ÿæ­å»ºçš„ç½—é«˜è¡¨ç™½å¢™(QQ1633934531)</h1>
        
        <div class="form-box">
            <div class="form-group">
                <label for="sender">ä½ çš„åå­—</label>
                <input type="text" id="sender" placeholder="ç•™ä¸‹ä½ çš„æ˜µç§°ï¼ˆå¯é€‰ï¼‰" />
            </div>
            <div class="form-group">
                <label for="receiver">è¡¨ç™½å¯¹è±¡</label>
                <input type="text" id="receiver" placeholder="å†™ç»™è°ï¼Ÿ[å¹´çº§ç­çº§]ï¼ˆå¿…å¡«ï¼‰" required />
            </div>
            <div class="form-group">
                <label for="content">è¡¨ç™½å†…å®¹</label>
                <textarea id="content" rows="4" placeholder="è¯´å‡ºä½ çš„å¿ƒæ„ï½ï¼ˆå¿…å¡«ï¼‰" required ></textarea>
            </div>
            <div class="form-group">
                <label for="notePwd">åˆ é™¤å¯†ç ï¼ˆå¿…å¡«ï¼Œç”¨äºåˆ é™¤è‡ªå·±çš„è¡¨ç™½ï¼‰</label>
                <input type="password" id="notePwd" placeholder="è®¾ç½®6-16ä½å¯†ç " required />
                <div class="password-tip">è¯·ç‰¢è®°å¯†ç ï¼Œåˆ é™¤æ—¶éœ€éªŒè¯</div>
            </div>
            <button id="submitBtn">å‘å¸ƒè¡¨ç™½</button>
        </div>
        
        <div class="wall" id="wall"></div>
    </div>

    <script>
        // å…¨å±€åŠ å¯†å¯†é’¥ï¼ˆå¯è‡ªè¡Œä¿®æ”¹ï¼Œå¢å¼ºå®‰å…¨æ€§ï¼‰
        const GLOBAL_SECRET_KEY = 'loveWall_2025_secure_key';
        
        // åŠ å¯†å‡½æ•°
        function encryptData(data) {
            return CryptoJS.AES.encrypt(JSON.stringify(data), GLOBAL_SECRET_KEY).toString();
        }
        
        // è§£å¯†å‡½æ•°
        function decryptData(encryptedData) {
            try {
                const bytes = CryptoJS.AES.decrypt(encryptedData, GLOBAL_SECRET_KEY);
                return JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
            } catch (e) {
                console.error('è§£å¯†å¤±è´¥', e);
                return [];
            }
        }

        // å¯†ç å“ˆå¸Œå¤„ç†ï¼ˆä¸å¯é€†ï¼Œé¿å…å­˜å‚¨æ˜æ–‡å¯†ç ï¼‰
        function hashPassword(password) {
            return CryptoJS.SHA256(password + GLOBAL_SECRET_KEY).toString();
        }

        // åˆå§‹åŒ–ï¼šä»localStorageè¯»å–å¹¶è§£å¯†è¡¨ç™½æ•°æ®
        let loveNotes = decryptData(localStorage.getItem('secureLoveWall')) || [];
        
        // DOMå…ƒç´ 
        const submitBtn = document.getElementById('submitBtn');
        const wall = document.getElementById('wall');
        const senderInput = document.getElementById('sender');
        const receiverInput = document.getElementById('receiver');
        const contentInput = document.getElementById('content');
        const notePwdInput = document.getElementById('notePwd');
        
        // æ¸²æŸ“è¡¨ç™½å¡ç‰‡
        function renderNotes() {
            wall.innerHTML = '';
            loveNotes.forEach((note, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <button class="delete-btn" data-index="${index}">Ã—</button>
                    <h3>è‡´ ${note.receiver}</h3>
                    <p>${note.content}</p>
                    <div class="time">${note.sender || 'åŒ¿å'} Â· ${note.time}</div>
                `;
                wall.appendChild(card);
            });
        }
        
        // æäº¤è¡¨ç™½
        submitBtn.addEventListener('click', () => {
            const sender = senderInput.value.trim();
            const receiver = receiverInput.value.trim();
            const content = contentInput.value.trim();
            const password = notePwdInput.value.trim();
            
            if (!receiver || !content) {
                alert('è¡¨ç™½å¯¹è±¡å’Œå†…å®¹ä¸èƒ½ä¸ºç©ºå“¦ï½');
                return;
            }
            if (password.length < 6 || password.length > 16) {
                alert('å¯†ç è¯·è®¾ç½®6-16ä½å“¦ï½');
                return;
            }
            
            // åˆ›å»ºè¡¨ç™½å¯¹è±¡ï¼ˆå­˜å‚¨å¯†ç å“ˆå¸Œå€¼ï¼‰
            const newNote = {
                sender,
                receiver,
                content,
                time: new Date().toLocaleString(),
                pwdHash: hashPassword(password)
            };
            
            loveNotes.unshift(newNote);
            // åŠ å¯†åå­˜å…¥localStorage
            localStorage.setItem('secureLoveWall', encryptData(loveNotes));
            
            // é‡ç½®è¡¨å•å¹¶é‡æ–°æ¸²æŸ“
            [senderInput, receiverInput, contentInput, notePwdInput].forEach(el => el.value = '');
            renderNotes();
        });
        
        // åˆ é™¤è¡¨ç™½ï¼ˆå¯†ç éªŒè¯ï¼‰
        wall.addEventListener('click', (e) => {
            if (e.target.classList.contains('delete-btn')) {
                const index = e.target.dataset.index;
                const targetNote = loveNotes[index];
                const inputPwd = prompt('è¯·è¾“å…¥åˆ é™¤å¯†ç ï¼š');
                
                if (!inputPwd) return;
                
                // éªŒè¯å¯†ç å“ˆå¸Œå€¼
                if (hashPassword(inputPwd) === targetNote.pwdHash) {
                    loveNotes.splice(index, 1);
                    localStorage.setItem('secureLoveWall', encryptData(loveNotes));
                    renderNotes();
                    alert('åˆ é™¤æˆåŠŸï¼');
                } else {
                    alert('å¯†ç é”™è¯¯ï¼Œæ— æ³•åˆ é™¤ï¼');
                }
            }
        });
        
        // é¡µé¢åŠ è½½æ—¶æ¸²æŸ“
        renderNotes();
    </script>
</body>
</html>
